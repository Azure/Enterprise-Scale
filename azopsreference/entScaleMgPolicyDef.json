{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "managementGroupId": {
            "type": "string",
            "metadata": {
                "description": "Please provide the management group id - similar to the management group selection above."
            }
        },
        "policyDefinition": {
            "type": "string",
            "allowedValues": [
                "Append Key Vault soft delete",
                "Deny App GW without WAF",
                "Deny ER peering",
                "Deny private DNS zones",
                "Deny Public Endpoint for AKS",
                "Deny Public Endpoint for CosmosDB",
                "Deny Public Endpoint for MariaDB",
                "Deny Public Endpoint for MySQL",
                "Deny Public Endpoint for PostGreSql",
                "Deny Public Endpoint for SQL",
                "Deny Public Endpoint for Storage",
                "Deny Public IP",
                "Deny Azure Automation child resources",
                "Deploy ASC Continous Export",
                "Deploy Azure Security Center",
                "Deploy Azure Backup for VMs",
                "Deploy DDoS Protection",
                "Deploy Diagnostics for Automation accounts",
                "Deploy Diagnostics for ACI",
                "Deploy Diagnostics for ACR",
                "Deploy Diagnostics for Activity Log",
                "Deploy Diagnostics for AKS",
                "Deploy Diagnostics for Analysis Service",
                "Deploy Diagnostics for API mgmt",
                "Deploy Diagnostics for Application Gateway",
                "Deploy Diagnostics for Batch",
                "Deploy Diagnostics for CDN Endpoints",
                "Deploy Diagnostics for Cognitive Services",
                "Deploy Diagnostics for CosmosDB",
                "Deploy Diagnostics for Data Factory",
                "Deploy Diagnostics for DataLake store",
                "Deploy Diagnostics for DL Analytics",
                "Deploy Diagnostics for EventGrid subscription",
                "Deploy Diagnostics for EventGrid topic",
                "Deploy Diagnostics for ExpressRoute",
                "Deploy Diagnostics for Firewall",
                "Deploy Diagnostics for HDInsight",
                "Deploy Diagnostics for IoT hub",
                "Deploy Diagnostics for KeyVault",
                "Deploy Diagnostics for Load Balancer",
                "Deploy Diagnostics for LogicApps ISE",
                "Deploy Diagnostics for LogicApps WF",
                "Deploy Diagnostics for MI Workspace",
                "Deploy Diagnostics for MySQL",
                "Deploy Diagnostics for NSG",
                "Deploy Diagnostics for NIC",
                "Deploy Diagnostics for PostGreSQL",
                "Deploy Diagnostics for PowerBi Embedded",
                "Deploy Diagnostics for PublicIp",
                "Deploy Diagnostics for RecoveryVault",
                "Deploy Diagnostics for RedisCache",
                "Deploy Diagnostics for Relay",
                "Deploy Diagnostics for SearchServices",
                "Deploy Diagnostics for ServiceBus",
                "Deploy Diagnostics for SignalR",
                "Deploy Diagnostics for SQLDb",
                "Deploy Diagnostics for SQL Elastic Pools",
                "Deploy Diagnostics for SQL MI",
                "Deploy Diagnostics for Stream Analytics",
                "Deploy Diagnostics for TimeSeries insights",
                "Deploy Diagnostics for Traffic Manager",
                "Deploy Diagnostics for Virtual Network",
                "Deploy Diagnostics for Virtual Machine",
                "Deploy Diagnostics for Virtual Machine Scale Sets",
                "Deploy Diagnostics for Virtual Network GW",
                "Deploy Diagnostics for WebServer farm",
                "Deploy Diagnostics for Web site",
                "Deploy DNS Zone Group for blob",
                "Deploy DNS Zone Group for file",
                "Deploy DNS Zone Group for Key Vault",
                "Deploy DNS Zone Group for queue",
                "Deploy DNS Zone Group for SQL",
                "Deploy DNS Zone Group for table",
                "Deploy Azure Firewall policy",
                "Deploy Hub",
                "Deploy Log Analytics configuration",
                "Deploy Log Analytics workspace",
                "Deploy NSG Flow logs",
                "Deploy SQL Auditing settings",
                "Deploy SQL Security alert policies",
                "Deploy Virtual Hub",
                "Deploy Virtual Network",
                "Deploy Virtual WAN",
                "Deploy Windows Domain Join VM extension"
            ]
        }
    },
    "variables": {
        "policyUri": "[uri(deployment().properties.templateLink.uri, '3fc1081d-6105-4e19-b60c-1ec1252cf560%20(3fc1081d-6105-4e19-b60c-1ec1252cf560)/contoso%20(contoso)/.AzState/')]",
        "templateUri": "https://raw.githubusercontent.com/Azure/AzOps/main/template/template.json",
        "policyMap": {
            "Append Key Vault soft delete": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Append-KV-SoftDelete.parameters.json')]",
            "Deny App GW without WAF": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-AppGW-Without-WAF.parameters.json')]",
            "Deny ER peering": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-ERPeering.parameters.json')]",
            "Deny private DNS zones": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-Private-DNS-Zones.parameters.json')]",
            "Deny Public Endpoint for AKS": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-Aks.parameters.json')]",
            "Deny Public Endpoint for CosmosDB": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-CosmosDB.parameters.json')]",
            "Deny Public Endpoint for KeyVault": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-KeyVault.parameters.json')]",
            "Deny Public Endpoint for MariaDB": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-MariaDB.parameters.json')]",
            "Deny Public Endpoint for MySQL": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-MySQL.parameters.json')]",
            "Deny Public Endpoint for PostGreSql": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-PostgreSql.parameters.json')]",
            "Deny Public Endpoint for SQL": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-Sql.parameters.json')]",
            "Deny Public Endpoint for Storage": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicEndpoint-Storage.parameters.json')]",
            "Deny Public IP": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-PublicIP.parameters.json')]",
            "Deny Azure Automation child resources": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-AA-child-resources.parameters.json')]",
            "Deny subnet without NSG": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deny-Subnet-Without-Nsg.parameters.json')]",
            "Deploy ASC Continous Export": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-ASC-CE.parameters.json')]",
            "Deploy Azure Security Center": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-ASC-Standard.parameters.json')]",
            "Deploy Azure Backup for VMs": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-AzureBackup-on-VM.parameters.json')]",
            "Deploy DDoS Protection": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DDoSProtection.parameters.json')]",
            "Deploy Diagnostics for Automation accounts": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-AA.parameters.json')]",
            "Deploy Diagnostics for ACI": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-ACI.parameters.json')]",
            "Deploy Diagnostics for ACR": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-ACR.parameters.json')]",
            "Deploy Diagnostics for Activity Log": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-ActivityLog.parameters.json')]",
            "Deploy Diagnostics for AKS": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-AKS.parameters.json')]",
            "Deploy Diagnostics for Analysis Service": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-AnalysisService.parameters.json')]",
            "Deploy Diagnostics for API mgmt": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-APIMgmt.parameters.json')]",
            "Deploy Diagnostics for Application Gateway": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-ApplicationGateway.parameters.json')]",
            "Deploy Diagnostics for Batch": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-Batch.parameters.json')]",
            "Deploy Diagnostics for CDN Endpoints": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-CDNEndpoints.parameters.json')]",
            "Deploy Diagnostics for Cognitive Services": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-CognitiveServices.parameters.json')]",
            "Deploy Diagnostics for CosmosDB": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-CosmosDB.parameters.json')]",
            "Deploy Diagnostics for Data Factory": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-DataFactory.parameters.json')]",
            "Deploy Diagnostics for DataLake store": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-DataLakeStore.parameters.json')]",
            "Deploy Diagnostics for DL Analytics": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-DLAnalytics.parameters.json')]",
            "Deploy Diagnostics for EventGrid subscription": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-EventGridSub.parameters.json')]",
            "Deploy Diagnostics for EventGrip topic": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-EventGridTopic.parameters.json')]",
            "Deploy Diagnostics for EventHub": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-EventHub.parameters.json')]",
            "Deploy Diagnostics for ExpressRoute": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-ExpressRoute.parameters.json')]",
            "Deploy Diagnostics for Firewall": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-Firewall.parameters.json')]",
            "Deploy Diagnostics for HDInsight": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-HDInsight.parameters.json')]",
            "Deploy Diagnostics for IoT hub": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-iotHub.parameters.json')]",
            "Deploy Diagnostics for KeyVault": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-KeyVault.parameters.json')]",
            "Deploy Diagnostics for Load Balancer": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-LoadBalancer.parameters.json')]",
            "Deploy Diagnostics for LogicApps ISE": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-LogicAppsISE.parameters.json')]",
            "Deploy Diagnostics for LogicApps WF": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-LogicAppsWF.parameters.json')]",
            "Deploy Diagnostics for MI Workspace": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-MlWorkspace.parameters.json')]",
            "Deploy Diagnostics for MySQL": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-MySQL.parameters.json')]",
            "Deploy Diagnostics for NSG": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-NetworkSecurityGroups.parameters.json')]",
            "Deploy Diagnostics for NIC": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-NIC.parameters.json')]",
            "Deploy Diagnostics for PostGreSQL": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-PostgreSQL.parameters.json')]",
            "Deploy Diagnostics for PowerBi Embedded": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-PowerBIEmbedded.parameters.json')]",
            "Deploy Diagnostics for PublicIp": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-PublicIP.parameters.json')]",
            "Deploy Diagnostics for RecoveryVault": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-RecoveryVault.parameters.json')]",
            "Deploy Diagnostics for RedisCache": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-RedisCache.parameters.json')]",
            "Deploy Diagnostics for Relay": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-Relay.parameters.json')]",
            "Deploy Diagnostics for SearchServices": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-SearchServices.parameters.json')]",
            "Deploy Diagnostics for ServiceBus": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-ServiceBus.parameters.json')]",
            "Deploy Diagnostics for SignalR": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-SignalR.parameters.json')]",
            "Deploy Diagnostics for SQLDb": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-SQLDBs.parameters.json')]",
            "Deploy Diagnostics for SQL Elastic Pools": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-SQLElasticPools.parameters.json')]",
            "Deploy Diagnostics for SQL MI": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-SQLMI.parameters.json')]",
            "Deploy Diagnostics for Stream Analytics": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-StreamAnalytics.parameters.json')]",
            "Deploy Diagnostics for TimeSeries insights": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-TimeSeriesInsights.parameters.json')]",
            "Deploy Diagnostics for Traffic Manager": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-TrafficManager.parameters.json')]",
            "Deploy Diagnostics for Virtual Network": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-VirtualNetwork.parameters.json')]",
            "Deploy Diagnostics for Virtual Machine": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-VM.parameters.json')]",
            "Deploy Diagnostics for Virtual Machine Scale Sets": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-VMSS.parameters.json')]",
            "Deploy Diagnostics for Virtual Network GW": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-VNetGW.parameters.json')]",
            "Deploy Diagnostics for WebServer farm": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-WebServerFarm.parameters.json')]",
            "Deploy Diagnostics for Web site": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Diagnostics-Website.parameters.json')]",
            "Deploy DNS Zone Group for blob": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DNSZoneGroup-For-Blob-PrivateEndpoint.parameters.json')]",
            "Deploy DNS Zone Group for file": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DNSZoneGroup-For-File-PrivateEndpoint.parameters.json')]",
            "Deploy DNS Zone Group for Key Vault": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DNSZoneGroup-For-KeyVault-PrivateEndpoint.parameters.json')]",
            "Deploy DNS Zone Group for queue": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DNSZoneGroup-For-Queue-PrivateEndpoint.parameters.json')]",
            "Deploy DNS Zone Group for SQL": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DNSZoneGroup-For-Sql-PrivateEndpoint.parameters.json')]",
            "Deploy DNS Zone Group for table": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-DNSZoneGroup-For-Table-PrivateEndpoint.parameters.json')]",
            "Deploy Azure Firewall policy": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-FirewallPolicy.parameters.json')]",
            "Deploy Hub": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-HUB.parameters.json')]",
            "Deploy Log Analytics configuration": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-LA-Config.parameters.json')]",
            "Deploy Log Analytics workspace": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Log-Analytics.parameters.json')]",
            "Deploy NSG Flow logs": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Nsg-FlowLogs.parameters.json')]",
            "Deploy SQL Auditing settings": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Sql-AuditingSettings.parameters.json')]",
            "Deploy SQL Security alert policies": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Sql-SecurityAlertPolicies.parameters.json')]",
            "Deploy SQL tde": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Sql-Tde.parameters.json')]",
            "Deploy SQL vulnerability assessments": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Sql-vulnerabilityAssessments.parameters.json')]",
            "Deploy Virtual Hub": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-vHUB.parameters.json')]",
            "Deploy Virtual Network": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-vNet.parameters.json')]",
            "Deploy Virtual WAN": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-vWAN.parameters.json')]",
            "Deploy Windows Domain Join VM extension": "[concat(variables('policyUri'), 'Microsoft.Authorization_policyDefinitions-Deploy-Windows-DomainJoin.parameters.json')]"
        },
        "policySelection": "[variables('policyMap')[parameters('policyDefinition')]]"
    },
    "resources": [
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2019-10-01",
            "location": "[deployment().location]",
            "name": "[take(concat('EntScale', 'oob-sub-policyDef-', guid(deployment().name)), 64)]",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('managementGroupId'))]",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[variables('templateUri')]"
                },
                "parametersLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[variables('policySelection')]"
                }
            }
        }
    ],
    "outputs": {
        "policyDefinition": {
            "type": "string",
            "value": "[concat('Deployment of ', variables('policySelection'), ' completed successfully at management group')]"
        }
    }
}