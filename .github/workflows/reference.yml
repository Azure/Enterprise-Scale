name: Reference

on: 
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
        
jobs:
  reference:
    name: Reference
    runs-on: ubuntu-latest
    steps:
      - name: Actions checkout
        uses: actions/checkout@v2
        with:
          path: enterprise-scale
      - name: Actions checkout
        uses: actions/checkout@v2
        with:
          repository: Azure/AzOps
          path: azops
      - name: Run script
        shell: pwsh
        run: |
          Save-Module -Name Az.Accounts -LiteralPath /usr/share/az_4.3.0 -RequiredVersion "1.9.0" -Force
          Save-Module -Name Az.Resources -LiteralPath /usr/share/az_4.3.0 -RequiredVersion "2.2.0" -Force
      - name: Run script
        shell: pwsh
        run: |
            Import-Module @("Az.Accounts", "Az.Resources")
            Import-Module .\azops\src\AzOps.psd1 -force
            Remove-Item -Path ".\AzOpsReference\3fc1081d-6105-4e19-b60c-1ec1252cf560" -Recurse -Force -Verbose
            Initialize-AzOpsRepository -SkipResourceGroup -GeneralizeTemplates -Force -Verbose
        env:
          AzOpsState: '.\AzOpsReference'
          GeneralizeTemplates: '1'