{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
         "logAnalyticsResourceId": {
            "type": "string",
            "metadata": {
                "description": "Provide the resourceId to the central Log Analytics workspace."
            }
         },
         //Currently not using the mgmtGroups parameter but receiving it in case we can use it. 
         "mgmtGroups": {
            "type": "object",
            "metadata": {
                "description": "Object with all Management Groups."
            }
         },
         "deploymentUris": {
            "type": "object",
            "metadata": {
                "description": "Deployment Uris."
            }
         },
          "topLevelManagementGroupPrefix": {
            "type": "string",
            "metadata": {
                "description": "Enterprise Scale Company Prefix."
            }
         }      
    },
    "variables": {
    },
    "resources": [
        {
  "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",  //Not using variables to define the name
            "name": "topLevelMG",
           "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'))]",
           "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"               
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }         
                }
            }
        },
       {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "platformMG",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'),'-platform')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },
       {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "managementMG",
          "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-management')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },     
       {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "connectivityMG",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-connectivity')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },
               {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "identityMG",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-identity')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },      
        {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "landingzonesMG",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-landingzones')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },     
  {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "corpMG",
            "scope": "[concat('Microsoft.Management/managementGroups/',parameters('topLevelManagementGroupPrefix'), '-corp')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },
  {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "onlineMG",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-online')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },      
             {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "decommissionedMG",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-decommissioned')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },      
  {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "sandboxes",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-sandboxes')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        }      
    ]
}      
