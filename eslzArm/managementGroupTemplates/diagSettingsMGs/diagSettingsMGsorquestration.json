{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
         "logAnalyticsResourceId": {
            "type": "string",
            "metadata": {
                "description": "Provide the resourceId to the central Log Analytics workspace."
            }
         },
         "mgmtGroups": {
            "type": "object",
            "metadata": {
                "description": "Object with all Management Groups."
            }
         },
         "deploymentUris": {
            "type": "object",
            "metadata": {
                "description": "Deployment Uris."
            }
         },
          "topLevelManagementGroupPrefix": {
            "type": "string",
            "metadata": {
                "description": "Enterprise Scale Company Prefix."
            }
         }      
    },
    "variables": {
    },
    "resources": [
        {
  "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
           "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'))]",
           "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
          //          "uri": "https://raw.githubusercontent.com/lachaves/Enterprise-Scale/main/eslzArm/managementGroupTemplates/diagSettingsMGs/diagSettingsMGs.json"
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"               
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }         
                }
            }
        },
       {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'),'-platform')]",
            //"scope": "Microsoft.Management/managementGroups/",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },
       {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
          "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-management')]",
          //  "scope": "Microsoft.Management/managementGroups/eslz-corp",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },     
       {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-connectivity')]",
            //"scope": "Microsoft.Management/managementGroups/eslz-corp",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },
               {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-identity')]",
            //"scope": "Microsoft.Management/managementGroups/eslz-corp",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },      
        {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-landingzones')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },     
  {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/',parameters('topLevelManagementGroupPrefix'), '-corp')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },
  {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-online')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },      
             {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-decommissioned')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        },      
  {
   "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
          //  "name": "[variables('deploymentNames').DiagnosticSettingsforMGsDeploymentName]",
            "name": "test",
            "scope": "[concat('Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-sandboxes')]",
            "location": "[deployment().location]",
            "dependsOn": [
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "contentVersion": "1.0.0.0",
                    "uri": "[parameters('deploymentUris').diagnosticSettingsforManagementGroups]"     
                },
                "parameters": {
                        "logAnalyticsResourceId": {
                             "value": "[parameters('logAnalyticsResourceId')]"
                    }
                }
            }
        }      
    ]
}      
